---
## ぱぶびゅ！Discord の目的

ぱぶびゅ！におけるDiscordの目的は以下
* メンバーのLoL愛を深めること
* メンバー同士が仲良くなること
* ぱぶびゅ！を好きになってもらうこと
ぱぶびゅ！botはこれらの目的達成を支援するコミュニティマネジメントのシステムである

---
## コンポーネント間の連携
システム間の連携は以下の流れ

### 1. ユーザー (User Client)

ユーザーは、PCやスマートフォンでDiscordアプリを使用し、ボットにコマンドを送信します。

-   **アクション**: `/register`, `/ranking` などのスラッシュコマンドを入力。
-   **通信先**: Discordサーバー

### 2. Discordサーバー (Discord Server)

Discordのバックエンドシステム。ユーザーからのコマンドを受け取り、ボットにイベントとして転送します。

-   **アクション**:
    -   ユーザーからのコマンドを受け付けます。
    -   コマンドの内容をボットにイベントとして通知します。
    -   ボットからのレスポンスをユーザーに表示します。
-   **通信先**: ユーザー、および **Kubernetes** 上で動作するボット

### 3. Kubernetes (K8s)

ボットアプリケーションを管理・実行するためのプラットフォーム。コンテナ化されたボットを安定して稼働させます。

-   **備考**:
　　-   k8s上のDiscord botは、起動時にDiscordバックエンドとのTCPコネクションを確立し、以降そのコネクションを利用し続ける為、k8sのエンドポイントがグローバルに公開されている必要はない
-   **アクション**:
    -   **Discordサーバー**からイベントを受け取り、ボットアプリケーションへ渡します。
    -   ボットは **Riot Games API** にアクセスしてデータを取得し、**Discordサーバー**にレスポンスを返します。
-   **通信先**: Discordサーバー、および Riot Games API


---
## 動作方法

### 0. k8s clusterの準備

このbotは、k8s上で動かすことを想定しています。

```
%kubectl version
Client Version: v1.32.2
Kustomize Version: v5.5.0
Server Version: v1.32.2
```

### 1. 必要なAPIキーの取得

このボットを動作させるには、以下の2つのAPIキーが必要です。
適当なDiscordサーバーを建て、手元で動作検証してください。

* **Riot API Key**
* **Discord Bot Token**

### 2. 環境変数の設定

取得したAPIキーとトークンを設定する。

```
kubectl create secret generic bot-secrets --from-literal=DISCORD_TOKEN='{Discord Bot Token}' --from-literal=RIOT_API_KEY='{Riot API Key}'
```

### 3. ボットの実行


```
%docker build -t lol-rank-bot:latest .

%kubectl apply -f deployment.yaml
```

---

## 使い方

ボットはスラッシュコマンド（`/`）で操作します。

### プレイヤー情報の登録と削除

#### `/register [game_name] [tag_line]`

あなたのRiot IDをボットに登録します。これにより、定期的なランクチェックやランキングの対象となります。

**例**: `/register ぱぶびゅー #JP1`

#### `/unregister`

ボットに登録したあなたの情報を削除します。

### ランクの確認とランキング表示

#### `/check [game_name] [tag_line]`

指定したRiot IDの現在のSolo/Duoランクをリアルタイムで確認します。登録していないユーザーのランクも調べられます。

**例**: `/check T1 Faker #KR1`

#### `/ranking`

サーバーに登録されている全ユーザーのSolo/Duoランクをランキング形式で表示します。

---

## 主な機能

### 🏆 定期的なランキング表示

毎日、指定された時刻（デフォルトではJST 12:00）に、全ユーザーの最新のランク情報を取得し、ランキングを自動で投稿します。

### 🎖️ ランク連動ロール

登録したプレイヤーのランクに応じて、Discordサーバー内の対応するランクロール（例: `LoL Gold(Solo/Duo)`）を自動で付与または更新します。

### 🎉 ランクアップ通知

ランクが上昇した際、Discordのチャンネルに自動で通知メッセージを送信し、みんなでお祝いできます。
